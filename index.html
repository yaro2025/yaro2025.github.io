<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Desktop UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', 'Tahoma', sans-serif;
            font-size: 14px;
            user-select: none;
            background-color: #1a1a1a;
        }
        .desktop {
            background-image: url('https://placehold.co/1920x1080/000000/FFFFFF?text=');
            background-size: cover;
            background-position: center;
            height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
            transition: background-image 1s ease-in-out;
        }
        .wallpaper-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
            color: white;
            font-size: 5rem;
            font-weight: bold;
            z-index: 2000;
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }
        .wallpaper-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .taskbar {
            background: rgba(30, 30, 30, 0.85);
            backdrop-filter: blur(12px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 48px;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .start-button {
            background: transparent;
            border: none;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .start-button:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .icon {
            width: 90px;
            height: 90px;
            text-align: center;
            color: white;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7);
            cursor: pointer;
            padding: 8px;
            border: 1px solid transparent;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        .icon p { word-break: break-word; }
        .icon:focus {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            outline: none;
        }
        .icon svg, .folder-icon svg {
            width: 48px;
            height: 48px;
            margin: 0 auto 4px auto;
        }
        .window {
            position: absolute;
            background: rgba(243, 243, 243, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0,0,0,0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            border-radius: 8px;
            resize: both;
            overflow: hidden;
            min-width: 350px;
            min-height: 250px;
            transition: box-shadow 0.2s;
        }
        .window.active {
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }
        .title-bar {
            background: rgba(229, 229, 229, 0.8);
            color: #1a1a1a;
            padding: 4px 4px 4px 12px;
            font-weight: 600;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        .window.active .title-bar {
             background: rgba(255, 255, 255, 0.85);
        }
        .title-bar-buttons button {
            width: 40px;
            height: 32px;
            background: transparent;
            border: none;
            color: #333;
            font-weight: normal;
            font-size: 16px;
            line-height: 32px;
            text-align: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .title-bar-buttons button:hover { background: rgba(0,0,0,0.1); }
        .title-bar-buttons button.close-btn:hover { background: #e81123; color: white; }
        .window-body { flex-grow: 1; padding: 10px; background: transparent; overflow-y: auto; }
        .folder-container { display: flex; flex-wrap: wrap; align-content: flex-start; gap: 10px; }
        .folder-icon {
            width: 85px;
            min-height: 85px;
            text-align: center;
            color: #333;
            cursor: pointer;
            padding: 8px 4px;
            border: 1px solid transparent;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        .folder-icon p { font-size: 12px; line-height: 1.3; word-break: break-word; }
        .folder-icon:hover { background: rgba(0, 120, 215, 0.1); }
        .folder-icon:focus { background: rgba(0, 120, 215, 0.2); border: 1px solid rgba(0, 120, 215, 0.5); outline: none; }
        .toolbar { background: rgba(255,255,255,0.5); padding: 4px 6px; border-bottom: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; gap: 8px; }
        .toolbar button { background: transparent; border: 1px solid transparent; padding: 4px 8px; border-radius: 4px; display: flex; align-items: center; gap: 4px; }
        .toolbar button:hover { background: rgba(0,0,0,0.1); }
        .address-bar { flex-grow: 1; background: white; border-radius: 4px; padding: 4px 8px; border: 1px solid #ccc; font-size: 12px; }
        .text-viewer-body, .image-viewer-body { font-family: 'Consolas', 'Courier New', monospace; white-space: pre-wrap; padding: 15px; font-size: 13px; color: #1a1a1a; display: flex; justify-content: center; align-items: center; }
        .image-viewer-body img { max-width: 100%; max-height: 100%; }
        .game-viewer-body { flex-grow: 1; overflow: hidden; }
        .game-viewer-body iframe { width: 100%; height: 100%; border: none; }
        .start-menu {
            position: absolute;
            bottom: 56px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            height: 600px;
            background: rgba(243, 243, 243, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 20px;
            color: #1a1a1a;
            transition: opacity 0.2s, transform 0.2s;
        }
        .start-menu.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateX(-50%) translateY(10px);
        }
        .start-menu-item { padding: 10px; border-radius: 4px; cursor: pointer; }
        .start-menu-item:hover { background: rgba(0, 120, 215, 0.1); }
    </style>
</head>
<body>
    <div id="wallpaperOverlay" class="wallpaper-overlay">с др мальчишка</div>
    <div id="desktop" class="desktop">
        <div id="questIcon" class="icon absolute top-8 left-8" tabindex="0">
            <svg xmlns="http://www.w3.org/2000/svg" fill="#4285F4" viewBox="0 0 48 48"><path d="M40 8H24l-4-4H8c-2.21 0-3.98 1.79-3.98 4L4 36c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4z"/></svg>
            <p>с др</p>
        </div>
    </div>

    <!-- Folder Window -->
    <div id="folderWindow" class="window hidden" style="top: 100px; left: 150px; width: 720px; height: 500px;">
        <div class="title-bar" id="folderWindowTitleBar">
            <span id="folderWindowTitle"></span>
            <div class="title-bar-buttons"><button>_</button><button>&#9633;</button><button id="closeFolderButton" class="close-btn">✕</button></div>
        </div>
        <div class="toolbar">
            <button id="backButton"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg></button>
            <div id="addressBar" class="address-bar"></div>
        </div>
        <div id="folderWindowBody" class="window-body folder-container"></div>
    </div>

    <!-- Text Viewer Window -->
    <div id="textViewerWindow" class="window hidden" style="top: 200px; left: 250px; width: 600px; height: 400px;">
        <div class="title-bar" id="textViewerTitleBar">
            <span id="textViewerTitle"></span>
            <div class="title-bar-buttons"><button>_</button><button>&#9633;</button><button id="closeTextViewerButton" class="close-btn">✕</button></div>
        </div>
        <div id="textViewerBody" class="window-body text-viewer-body"></div>
    </div>
    
    <!-- Image Viewer Window -->
    <div id="imageViewerWindow" class="window hidden" style="top: 150px; left: 350px; width: 800px; height: 600px;">
        <div class="title-bar" id="imageViewerTitleBar">
            <span id="imageViewerTitle"></span>
            <div class="title-bar-buttons"><button>_</button><button>&#9633;</button><button id="closeImageViewerButton" class="close-btn">✕</button></div>
        </div>
        <div class="window-body image-viewer-body"><img id="imageViewerContent" src="" alt="Просмотр изображения"></div>
    </div>

    <!-- Game Viewer Window -->
    <div id="gameWindow" class="window hidden" style="top: 120px; left: 220px; width: 640px; height: 510px;">
        <div class="title-bar" id="gameWindowTitleBar">
            <span id="gameWindowTitle"></span>
            <div class="title-bar-buttons"><button>_</button><button>&#9633;</button><button id="closeGameButton" class="close-btn">✕</button></div>
        </div>
        <div class="game-viewer-body"><iframe id="gameFrame"></iframe></div>
    </div>

    <!-- Start Menu -->
    <div id="startMenu" class="start-menu hidden">
        <h2 class="text-xl font-semibold mb-4">Pinned</h2>
        <div class="start-menu-item">Settings</div><div class="start-menu-item">Power</div><div class="start-menu-item">File Explorer</div>
    </div>

    <div class="taskbar">
        <button id="startButton" class="start-button">
            <svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H22V22H6V6Z" fill="#0078D4"></path><path d="M26 6H42V22H26V6Z" fill="#0078D4"></path><path d="M6 26H22V42H6V26Z" fill="#0078D4"></path><path d="M26 26H42V42H26V26Z" fill="#0078D4"></path></svg>
        </button>
        <div class="flex-grow"></div>
        <div id="clock" class="text-white px-4 text-sm"></div>
    </div>

    <script>
        // --- FILE SYSTEM ---
        const questFolders = {};
        const trollPath = {
            'Не заходи сюда': { type: 'folder', children: {
                'Серьезно, тут ничего нет': { type: 'folder', children: {
                    'Подвязывай, мальчишка': { type: 'folder', children: {
                        'Ох и чепуха': { type: 'folder', children: {
                            'fun.jpg': { type: 'image', src: 'https://placehold.co/800x600/FF69B4/FFFFFF?text=FUN!' },
                            'hint.txt': { type: 'file', content: 'Начало игры в "Папка 42".' }
                        }}
                    }}
                }}
            }}
        };

        for (let i = 1; i <= 1000; i++) {
            const folderName = `Папка ${i}`;
            if (i <= 41) {
                questFolders[folderName] = { type: 'folder', children: JSON.parse(JSON.stringify(trollPath)) };
            } else if (i === 42) {
                questFolders[folderName] = { type: 'folder', children: {
                    'hint1.html': { type: 'game' }
                }};
            } else {
                 questFolders[folderName] = { type: 'folder', children: {} };
                 if (i === 1000) {
                     questFolders[folderName].children['final_surprise.txt'] = { type: 'file', content: 'Поздравляю! Ты прошел квест! С Днем Рождения!' };
                 }
            }
        }

        const fileSystem = { 'с др': { type: 'folder', children: questFolders } };

        // --- DOM ELEMENTS ---
        const desktop = document.getElementById('desktop');
        const wallpaperOverlay = document.getElementById('wallpaperOverlay');
        const questIcon = document.getElementById('questIcon');
        const folderWindow = document.getElementById('folderWindow');
        const textViewerWindow = document.getElementById('textViewerWindow');
        const imageViewerWindow = document.getElementById('imageViewerWindow');
        const gameWindow = document.getElementById('gameWindow');
        const folderWindowTitle = document.getElementById('folderWindowTitle');
        const folderWindowBody = document.getElementById('folderWindowBody');
        const textViewerTitle = document.getElementById('textViewerTitle');
        const textViewerBody = document.getElementById('textViewerBody');
        const imageViewerTitle = document.getElementById('imageViewerTitle');
        const imageViewerContent = document.getElementById('imageViewerContent');
        const gameWindowTitle = document.getElementById('gameWindowTitle');
        const gameFrame = document.getElementById('gameFrame');
        const closeFolderButton = document.getElementById('closeFolderButton');
        const closeTextViewerButton = document.getElementById('closeTextViewerButton');
        const closeImageViewerButton = document.getElementById('closeImageViewerButton');
        const closeGameButton = document.getElementById('closeGameButton');
        const backButton = document.getElementById('backButton');
        const addressBar = document.getElementById('addressBar');
        const clock = document.getElementById('clock');
        const startButton = document.getElementById('startButton');
        const startMenu = document.getElementById('startMenu');
        const allWindows = document.querySelectorAll('.window');

        // --- STATE ---
        let currentPath = [];
        let historyStack = [];

        // --- ICONS (SVG) ---
        const folderSVG = `<svg xmlns="http://www.w3.org/2000/svg" fill="#4285F4" viewBox="0 0 48 48"><path d="M40 8H24l-4-4H8c-2.21 0-3.98 1.79-3.98 4L4 36c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4z"/></svg>`;
        const fileSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M38 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V14l-8-8z" fill="#90a4ae"/><path d="M28 6v10h10L28 6z" fill="#cfd8dc"/><path d="M38 42H10c-2.21 0-4-1.79-4-4V10c0-2.21 1.79-4 4-4h18" fill="#fff"/><path d="M18 22h12v2H18zm0 6h12v2H18zm0 6h8v2h-8z" fill="#7f8c8d"/></svg>`;
        const imageSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g><path d="M38 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V14l-8-8z" fill="#2196f3"/><path d="M28 6v10h10L28 6z" fill="#bbdefb"/><path d="M38 42H10c-2.21 0-4-1.79-4-4V10c0-2.21 1.79-4 4-4h18" fill="#e3f2fd"/><path d="m32 27-6 8-5-6-7 9h26l-8-11z" fill="#78909c"/></g></svg>`;
        const gameSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g><path d="M38 6H10c-2.21 0-4 1.79-4 4v28c0 2.21 1.79 4 4 4h28c2.21 0 4-1.79 4-4V14l-8-8z" fill="#ff9800"/><path d="M28 6v10h10L28 6z" fill="#ffcc80"/><path d="M38 42H10c-2.21 0-4-1.79-4-4V10c0-2.21 1.79-4 4-4h18" fill="#fff3e0"/><path d="M18.6 33l-3.6-2.1 6-10.2 3.6 2.1-6 10.2zm12-12l-6-3.5-2.4 4.1 6 3.5 2.4-4.1z" fill="#795548"/></g></svg>`;
        
        // --- FUNCTIONS ---
        function updateClock() { clock.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); }

        function renderFolderContents(pathArray) {
            let currentLevel = fileSystem;
            for (const folderName of pathArray) {
                currentLevel = currentLevel[folderName]?.children;
                if (!currentLevel) { console.error("Path not found:", pathArray.join('/')); return; }
            }
            
            folderWindowBody.innerHTML = '';
            Object.entries(currentLevel).forEach(([name, item]) => {
                const iconDiv = document.createElement('div');
                iconDiv.className = 'folder-icon';
                iconDiv.tabIndex = 0;
                
                if (item.type === 'folder') iconDiv.innerHTML = folderSVG;
                else if (item.type === 'file') iconDiv.innerHTML = fileSVG;
                else if (item.type === 'image') iconDiv.innerHTML = imageSVG;
                else if (item.type === 'game') iconDiv.innerHTML = gameSVG;
                
                const iconName = document.createElement('p');
                iconName.textContent = name;
                iconDiv.appendChild(iconName);
                
                iconDiv.addEventListener('dblclick', () => {
                    if (item.type === 'folder') {
                        historyStack.push([...currentPath]);
                        currentPath.push(name);
                        renderFolderContents(currentPath);
                    } else if (item.type === 'file') {
                        openTextViewer(name, item.content);
                    } else if (item.type === 'image') {
                        openImageViewer(name, item.src);
                    } else if (item.type === 'game') {
                        openGameWindow(name);
                    }
                });
                folderWindowBody.appendChild(iconDiv);
            });
            updateWindowTitleAndAddress();
        }

        function updateWindowTitleAndAddress() {
            const title = currentPath.length > 0 ? currentPath[currentPath.length - 1] : 'Рабочий стол';
            folderWindowTitle.textContent = title;
            addressBar.textContent = currentPath.join(' > ');
        }
        
        function setActiveWindow(activeWindow) {
            allWindows.forEach(win => win.classList.remove('active'));
            if (activeWindow) activeWindow.classList.add('active');
        }

        function openWindow(windowEl, titleEl, title) {
            titleEl.textContent = title;
            windowEl.classList.remove('hidden');
            setActiveWindow(windowEl);
        }

        function openFolderWindow() {
            currentPath = ['с др'];
            historyStack = [];
            renderFolderContents(currentPath);
            folderWindow.classList.remove('hidden');
            setActiveWindow(folderWindow);
        }

        function openTextViewer(fileName, content) { openWindow(textViewerWindow, textViewerTitle, `${fileName} - Notepad`); textViewerBody.textContent = content; }
        function openImageViewer(fileName, src) { openWindow(imageViewerWindow, imageViewerTitle, fileName); imageViewerContent.src = src; }
        
        function openGameWindow(fileName) {
            openWindow(gameWindow, gameWindowTitle, fileName);
            // This now points to a relative path. This will only work if a file
            // named 'hint1.html' exists in the same directory as this main file,
            // or if a server is configured to handle this route.
            gameFrame.src = '/hint1.html';
        }

        function closeWindow(windowEl) { windowEl.classList.add('hidden'); }
        function goBack() { if (historyStack.length > 0) { currentPath = historyStack.pop(); renderFolderContents(currentPath); } }
        
        function makeDraggable(windowEl, titleBarEl) {
            let isDragging = false, offsetX, offsetY;
            const dragStart = (e) => {
                if (e.target.tagName === 'BUTTON') return;
                isDragging = true;
                const event = e.type === 'touchstart' ? e.touches[0] : e;
                offsetX = event.clientX - windowEl.offsetLeft;
                offsetY = event.clientY - windowEl.offsetTop;
                document.body.style.cursor = 'move';
                setActiveWindow(windowEl);
            };
            const dragMove = (e) => {
                if (isDragging) {
                    const event = e.type === 'touchmove' ? e.touches[0] : e;
                    let newX = event.clientX - offsetX;
                    let newY = event.clientY - offsetY;
                    const desktopRect = desktop.getBoundingClientRect();
                    newX = Math.max(0, Math.min(newX, desktopRect.width - windowEl.offsetWidth));
                    newY = Math.max(0, Math.min(newY, desktopRect.height - windowEl.offsetHeight));
                    windowEl.style.left = `${newX}px`;
                    windowEl.style.top = `${newY}px`;
                }
            };
            const dragEnd = () => { isDragging = false; document.body.style.cursor = 'default'; };
            titleBarEl.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
            titleBarEl.addEventListener('touchstart', dragStart);
            document.addEventListener('touchmove', dragMove);
            document.addEventListener('touchend', dragEnd);
            windowEl.addEventListener('mousedown', () => setActiveWindow(windowEl));
        }

        questIcon.addEventListener('dblclick', openFolderWindow);
        closeFolderButton.addEventListener('click', () => closeWindow(folderWindow));
        closeTextViewerButton.addEventListener('click', () => closeWindow(textViewerWindow));
        closeImageViewerButton.addEventListener('click', () => closeWindow(imageViewerWindow));
        closeGameButton.addEventListener('click', () => { closeWindow(gameWindow); gameFrame.src = 'about:blank'; });
        backButton.addEventListener('click', goBack);
        startButton.addEventListener('click', (e) => { e.stopPropagation(); startMenu.classList.toggle('hidden'); });
        desktop.addEventListener('click', () => { if (!startMenu.classList.contains('hidden')) startMenu.classList.add('hidden'); });

        window.onload = () => {
            setTimeout(() => {
                wallpaperOverlay.classList.add('hidden');
                desktop.style.backgroundImage = `url('wall.jpg'), url('https://placehold.co/1920x1080/3a6ea5/ffffff?text=wall.jpg')`;
            }, 5000);
        };
        updateClock();
        setInterval(updateClock, 1000);
        makeDraggable(folderWindow, folderWindow.querySelector('.title-bar'));
        makeDraggable(textViewerWindow, textViewerWindow.querySelector('.title-bar'));
        makeDraggable(imageViewerWindow, imageViewerWindow.querySelector('.title-bar'));
        makeDraggable(gameWindow, gameWindow.querySelector('.title-bar'));
    </script>
</body>
</html>
